---
phase: 06-dark-mode
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/index.html
  - apps/web/src/styles/theme-variables.css
autonomous: true

must_haves:
  truths:
    - "No white flash occurs when loading page in dark mode"
    - "Semantic color variables exist for success, warning, danger, and info states in both themes"
  artifacts:
    - path: "apps/web/index.html"
      provides: "Inline FOUC prevention script"
      contains: "data-theme"
    - path: "apps/web/src/styles/theme-variables.css"
      provides: "Complete color palette for both themes including semantic status colors"
      contains: "color-success"
  key_links:
    - from: "apps/web/index.html"
      to: "localStorage emohub-settings"
      via: "inline script reads stored theme before first paint"
      pattern: "localStorage.*emohub-settings"
    - from: "apps/web/src/styles/theme-variables.css"
      to: "[data-theme='dark']"
      via: "CSS variable overrides"
      pattern: "color-success|color-warning|color-danger"
---

<objective>
Add FOUC prevention and expand the CSS variable palette with semantic status colors.

Purpose: Prevent white flash on dark mode page load (critical UX issue) and provide CSS variables for all hardcoded colors so Plan 02 can convert components.
Output: Updated index.html with inline theme script, expanded theme-variables.css with status color variables.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-settings-foundation/05-01-SUMMARY.md
@apps/web/index.html
@apps/web/src/styles/theme-variables.css
@apps/web/src/stores/settingsStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add FOUC prevention inline script to index.html</name>
  <files>apps/web/index.html</files>
  <action>
Add a blocking inline script inside the `<head>` tag of index.html, BEFORE any stylesheets or module scripts. This script must:

1. Read `localStorage.getItem('emohub-settings')` (matches the Zustand persist key in settingsStore.ts)
2. Parse the JSON and extract `state.theme` (the persist middleware wraps state in `{ state: {...} }`)
3. If theme is `'light'` or `'dark'`, set `document.documentElement.setAttribute('data-theme', theme)`
4. If theme is `'system'` or missing, check `window.matchMedia('(prefers-color-scheme: dark)').matches` and set `data-theme` to `'dark'` or `'light'` accordingly
5. Wrap in try/catch â€” on any parse error, fall back to system preference detection
6. If no stored settings exist at all, fall back to system preference detection

The script must be synchronous (no `type="module"`, no `defer`, no `async`) so it blocks rendering until the attribute is set.

Use this exact implementation from the research:
```html
<script>
  (function() {
    var stored = localStorage.getItem('emohub-settings');
    if (stored) {
      try {
        var parsed = JSON.parse(stored);
        var theme = parsed.state && parsed.state.theme || 'system';
        var resolved = theme === 'system'
          ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
          : theme;
        document.documentElement.setAttribute('data-theme', resolved);
      } catch (e) {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.documentElement.setAttribute('data-theme', 'dark');
        }
      }
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
  })();
</script>
```

Note: Use `var` not `const`/`let` for maximum browser compatibility in inline scripts.
  </action>
  <verify>
Verify index.html contains the inline script in the head:
- `grep 'emohub-settings' apps/web/index.html` returns a match
- `grep 'data-theme' apps/web/index.html` returns a match
- The script appears BEFORE the closing `</head>` tag
- TypeScript compilation still passes: `npx tsc --noEmit`
  </verify>
  <done>index.html has a synchronous inline script that reads the persisted theme from localStorage and sets data-theme on documentElement before first paint, preventing FOUC.</done>
</task>

<task type="auto">
  <name>Task 2: Expand CSS variables with semantic status colors</name>
  <files>apps/web/src/styles/theme-variables.css</files>
  <action>
Add semantic status color variables to both the `:root` (light) and `[data-theme='dark']` blocks in theme-variables.css. These variables will replace hardcoded hex colors in components (Plan 02).

Add these variables to the `:root` block (light theme):
```css
/* Status colors */
--color-success: #10b981;
--color-success-bg: #f0fdf4;
--color-success-border: #bbf7d0;
--color-warning: #f59e0b;
--color-warning-bg: #fffbeb;
--color-warning-border: #fde68a;
--color-danger: #ef4444;
--color-danger-bg: #fef2f2;
--color-danger-border: #fecaca;
--color-info: #3b82f6;

/* Overlay and surface */
--color-overlay: rgba(0, 0, 0, 0.5);
--color-overlay-heavy: rgba(0, 0, 0, 0.6);
--color-surface-float: rgba(255, 255, 255, 0.8);
--color-shadow: rgba(0, 0, 0, 0.1);

/* Disabled state */
--color-disabled-bg: #e5e7eb;
--color-disabled-text: #9ca3af;
```

Add these variables to the `[data-theme='dark']` block (dark theme):
```css
/* Status colors */
--color-success: #34d399;
--color-success-bg: #064e3b;
--color-success-border: #065f46;
--color-warning: #fbbf24;
--color-warning-bg: #451a03;
--color-warning-border: #78350f;
--color-danger: #f87171;
--color-danger-bg: #450a0a;
--color-danger-border: #7f1d1d;
--color-info: #60a5fa;

/* Overlay and surface */
--color-overlay: rgba(0, 0, 0, 0.7);
--color-overlay-heavy: rgba(0, 0, 0, 0.8);
--color-surface-float: rgba(31, 41, 55, 0.9);
--color-shadow: rgba(0, 0, 0, 0.3);

/* Disabled state */
--color-disabled-bg: #374151;
--color-disabled-text: #6b7280;
```

Keep all existing variables unchanged. Add the new variables after the existing ones in each block.

Dark theme rationale:
- Status colors are slightly lighter/more saturated for readability on dark backgrounds
- Status backgrounds use deep, muted versions of the hue (not inverted light colors)
- Overlays are more opaque in dark mode for better contrast
- Surface float uses a semi-transparent dark gray instead of white
- Shadow is more opaque since dark backgrounds need stronger shadows
  </action>
  <verify>
Verify the CSS file has all new variables:
- `grep 'color-success' apps/web/src/styles/theme-variables.css` shows matches in both blocks
- `grep 'color-danger' apps/web/src/styles/theme-variables.css` shows matches in both blocks
- `grep 'color-overlay' apps/web/src/styles/theme-variables.css` shows matches in both blocks
- `grep 'color-disabled' apps/web/src/styles/theme-variables.css` shows matches in both blocks
- No syntax errors: the CSS file parses correctly
  </verify>
  <done>theme-variables.css defines semantic status colors (success, warning, danger, info), overlay colors, surface colors, shadow colors, and disabled state colors for both light and dark themes.</done>
</task>

</tasks>

<verification>
1. `grep 'emohub-settings' apps/web/index.html` confirms FOUC script present
2. `grep -c 'color-success\|color-danger\|color-warning\|color-info\|color-overlay\|color-disabled' apps/web/src/styles/theme-variables.css` returns 20+ matches (variables in both theme blocks)
3. `npx tsc --noEmit` passes with zero errors
4. Build succeeds: `cd apps/web && npx vite build --mode development 2>&1 | tail -5`
</verification>

<success_criteria>
- index.html contains synchronous inline script that prevents FOUC by setting data-theme before first paint
- theme-variables.css has complete semantic color palette for both light and dark themes
- All existing variables remain unchanged
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-dark-mode/06-01-SUMMARY.md`
</output>
