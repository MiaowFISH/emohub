---
phase: 09-visual-polish
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - apps/web/src/components/ImageGrid.tsx
  - apps/web/src/components/ImageLightbox.tsx
  - apps/web/src/stores/settingsStore.ts
autonomous: true

must_haves:
  truths:
    - "Image cards use CSS class for hover effects instead of inline onMouseEnter/onMouseLeave handlers"
    - "Theme switching shows smooth 300ms color transition across all elements"
    - "Lightbox opens with explicit fade animation configuration"
    - "User with reduced motion preference sees instant theme switch and no card scale on hover"
    - "All transitions work identically in light and dark themes"
  artifacts:
    - path: "apps/web/src/components/ImageGrid.tsx"
      provides: "Image cards using .image-card CSS class from transitions.css"
      contains: "image-card"
    - path: "apps/web/src/stores/settingsStore.ts"
      provides: "Smooth theme transition via theme-transitioning class toggle"
      contains: "theme-transitioning"
    - path: "apps/web/src/components/ImageLightbox.tsx"
      provides: "Explicit lightbox animation configuration"
      contains: "animation"
  key_links:
    - from: "apps/web/src/components/ImageGrid.tsx"
      to: "apps/web/src/styles/transitions.css"
      via: "CSS class .image-card applied to card divs"
      pattern: "className.*image-card"
    - from: "apps/web/src/stores/settingsStore.ts"
      to: "apps/web/src/styles/transitions.css"
      via: "JS adds/removes theme-transitioning class during theme switch"
      pattern: "theme-transitioning"
---

<objective>
Apply transition infrastructure to components: refactor ImageGrid hover to CSS classes, add smooth theme switching to settingsStore, and configure lightbox animation timing.

Purpose: This is the user-facing plan — after this, all five success criteria from the phase are met. Cards hover smoothly, theme switches animate, lightbox fades in, and reduced-motion users get instant state changes.

Output: Refactored ImageGrid.tsx, updated settingsStore.ts with theme transition logic, configured ImageLightbox.tsx animation props.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-visual-polish/09-RESEARCH.md
@.planning/phases/09-visual-polish/09-01-SUMMARY.md

@apps/web/src/components/ImageGrid.tsx
@apps/web/src/components/ImageLightbox.tsx
@apps/web/src/stores/settingsStore.ts
@apps/web/src/styles/transitions.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor ImageGrid to use CSS classes for hover effects</name>
  <files>apps/web/src/components/ImageGrid.tsx</files>
  <action>
Refactor the image card div in ImageGrid.tsx to use the `.image-card` CSS class from transitions.css instead of inline event handlers.

**Remove from the card div (the one with `key={image.id}`):**
- The `onMouseEnter` handler that sets `transform: scale(1.02)` and `boxShadow`
- The `onMouseLeave` handler that resets `transform` and `boxShadow`
- The inline `transition: 'all 0.2s ease'` style
- The inline `cursor: 'pointer'`, `borderRadius: '8px'`, `overflow: 'hidden'` styles (these are now in `.image-card` CSS class)

**Replace with:**
- `className={`image-card${isSelected ? ' selected' : ''}`}`
- Keep only the `border` style as inline ONLY for the selected state override: `style={{ border: isSelected ? '3px solid var(--color-accent)' : undefined }}`

Wait — actually the `.image-card` class already has `border: 1px solid var(--color-border)` and `.image-card.selected` has `border: 3px solid var(--color-accent)`. So remove the inline border style entirely and use the className for both states.

**Final card div should look like:**
```tsx
<div
  key={image.id}
  className={`image-card${isSelected ? ' selected' : ''}`}
  style={{ position: 'relative' }}
  onClick={() => onImageClick(globalIndex)}
>
```

The `position: relative` must stay inline because the virtualizer layout requires it for absolute-positioned children (spinner, copy button, checkbox, tag pills).

**Also add the CSS import** at the top of the file:
```tsx
import '@/styles/transitions.css'
```

This ensures transitions.css is loaded when ImageGrid renders (it's also in main.tsx, but co-locating the import makes the dependency explicit).

**Do NOT change:** The copy button's inline opacity/transition styles (these are controlled by the `.image-card-copy-btn` class in buttons.css with the `div:hover > .image-card-copy-btn` rule). The checkbox div's inline styles. The tag pills' inline styles. The skeleton loading section. The empty state section.
  </action>
  <verify>
1. `grep "onMouseEnter" apps/web/src/components/ImageGrid.tsx` — should return NO matches (inline handlers removed)
2. `grep "onMouseLeave" apps/web/src/components/ImageGrid.tsx` — should return NO matches
3. `grep "image-card" apps/web/src/components/ImageGrid.tsx` — should show className usage
4. `grep "transitions.css" apps/web/src/components/ImageGrid.tsx` — import present
5. Open app, hover over image cards — smooth scale(1.02) + shadow effect visible
6. Enable reduced motion — hover shows shadow but no scale
7. Select an image — blue border appears, hover still works
  </verify>
  <done>ImageGrid card divs use `.image-card` and `.image-card.selected` CSS classes. No inline onMouseEnter/onMouseLeave handlers. Hover effects (scale, shadow, border-color) come from transitions.css. Reduced-motion users see shadow/border feedback without scale animation.</done>
</task>

<task type="auto">
  <name>Task 2: Add smooth theme switching and configure lightbox animations</name>
  <files>apps/web/src/stores/settingsStore.ts, apps/web/src/components/ImageLightbox.tsx</files>
  <action>
**settingsStore.ts — Add smooth theme transition:**

Modify the `applyTheme` function to enable smooth color transitions during theme switch:

```typescript
function applyTheme(theme: Theme) {
  const html = document.documentElement
  const resolved = resolveTheme(theme)

  // Enable smooth color transitions for theme switch
  html.classList.add('theme-transitioning')

  // Apply the theme
  html.setAttribute('data-theme', resolved)

  // Remove transition class after animation completes (300ms)
  setTimeout(() => {
    html.classList.remove('theme-transitioning')
  }, 350) // Slightly longer than 300ms transition to ensure completion
}
```

The `theme-transitioning` class (defined in transitions.css from Plan 01) applies `transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, fill 0.3s ease` to all elements. This creates a smooth color crossfade when switching themes.

The class is removed after 350ms so transitions don't interfere with normal interactions (hover, focus, etc.).

**Important:** The global `prefers-reduced-motion` override in transitions.css already handles reduced-motion users — they'll see instant theme switch because `transition-duration: 0.01ms !important` overrides the theme-transitioning class. No additional JS check needed.

**Important:** The `no-transitions` class from index.html (Plan 01) prevents this from firing on initial page load. The `applyTheme` call on line 43 (`applyTheme(useSettingsStore.getState().theme)`) runs after the inline script has already set the theme, so the `theme-transitioning` class will be added but `no-transitions` suppresses it. After the double-rAF removes `no-transitions`, subsequent theme switches will animate.

**ImageLightbox.tsx — Configure explicit animation settings:**

Add the `animation` prop to the `<Lightbox>` component:

```tsx
<Lightbox
  open
  close={onClose}
  index={index}
  slides={slides}
  animation={{
    fade: 250,
    swipe: 250,
    navigation: 250,
  }}
  carousel={{ finite: false }}
  controller={{ closeOnBackdropClick: true }}
  on={{ view: handleView }}
/>
```

Add the `animation` prop between `slides` and `carousel`. The values (250ms) match the "base" timing from the research recommendations (250-300ms for modal/navigation). The lightbox library handles its own reduced-motion support internally.

**Do NOT change:** The TagInput overlay below the lightbox. The handleView callback. The handleTagsChange function. The copy button overlay (from Phase 8).
  </action>
  <verify>
1. `grep "theme-transitioning" apps/web/src/stores/settingsStore.ts` — class toggle present in applyTheme
2. `grep "setTimeout" apps/web/src/stores/settingsStore.ts` — cleanup timer present
3. `grep "animation" apps/web/src/components/ImageLightbox.tsx` — animation prop present
4. `grep "fade: 250" apps/web/src/components/ImageLightbox.tsx` — correct timing values
5. Open app → Settings → toggle theme — smooth 300ms color transition visible
6. Toggle theme with reduced motion enabled — instant switch (no animation)
7. Click image to open lightbox — smooth fade-in visible
8. Navigate slides with arrow keys — smooth slide transition
9. Build check: `cd apps/web && npx tsc --noEmit` passes
  </verify>
  <done>Theme switching shows smooth 300ms color crossfade via theme-transitioning class. Reduced-motion users see instant switch. Lightbox has explicit 250ms fade/swipe/navigation animation configuration. Both features work in light and dark themes.</done>
</task>

</tasks>

<verification>
**Phase 9 Complete Verification (all 5 success criteria):**

1. **Smooth hover effects on buttons and image cards:**
   - Hover over image cards → scale(1.02) + shadow + accent border (from .image-card CSS)
   - Hover over buttons → background color change (existing, now with focus-visible parity)

2. **Smooth fade-in when modals open:**
   - Click image → lightbox opens with 250ms fade animation
   - Navigate slides → 250ms swipe/navigation transitions

3. **Smooth transition when switching themes:**
   - Settings → toggle theme → 300ms color crossfade across all elements
   - No flash, no jarring instant switch

4. **Reduced motion preference → instant state changes:**
   - Enable OS reduced motion → all transitions become 0.01ms (global override)
   - Theme switch is instant, card hover shows no scale, sidebar opens instantly
   - Skeleton shimmer is disabled (existing from Phase 8)

5. **All animations work in both light and dark themes:**
   - Test each interaction in light mode, then switch to dark and repeat
   - Colors transition correctly between theme palettes
   - Shadows use var(--color-shadow) which adapts per theme
</verification>

<success_criteria>
- ImageGrid uses .image-card CSS class, no inline mouse event handlers for hover
- Theme switch triggers 300ms smooth color transition via theme-transitioning class
- Lightbox has explicit animation={{ fade: 250, swipe: 250, navigation: 250 }} configuration
- Reduced-motion users see instant state changes for all interactions
- No build errors, no visual regressions in either theme
</success_criteria>

<output>
After completion, create `.planning/phases/09-visual-polish/09-02-SUMMARY.md`
</output>
