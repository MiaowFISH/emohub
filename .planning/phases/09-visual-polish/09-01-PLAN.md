---
phase: 09-visual-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/styles/transitions.css
  - apps/web/src/styles/buttons.css
  - apps/web/src/styles/responsive.css
  - apps/web/src/main.tsx
  - apps/web/index.html
autonomous: true

must_haves:
  truths:
    - "Buttons show visible focus ring when navigated via keyboard (Tab key)"
    - "Sidebar slide animation is disabled when user has prefers-reduced-motion enabled"
    - "No color flash occurs on page load — transitions are suppressed until app is ready"
    - "Transition utility classes are available for consistent timing across components"
  artifacts:
    - path: "apps/web/src/styles/transitions.css"
      provides: "Centralized transition utilities and global reduced-motion override"
      contains: "prefers-reduced-motion"
    - path: "apps/web/src/styles/buttons.css"
      provides: "Focus-visible states matching hover states for all button types"
      contains: "focus-visible"
    - path: "apps/web/src/styles/responsive.css"
      provides: "Sidebar transition with reduced-motion support"
      contains: "prefers-reduced-motion"
  key_links:
    - from: "apps/web/src/main.tsx"
      to: "apps/web/src/styles/transitions.css"
      via: "CSS import"
      pattern: "import.*transitions\\.css"
    - from: "apps/web/index.html"
      to: "no-transitions class"
      via: "inline script adds class to prevent FOUC"
      pattern: "no-transitions"
---

<objective>
Create CSS transition foundation: utility classes, focus-visible states, reduced-motion support, and FOUC prevention for theme transitions.

Purpose: Establish the CSS infrastructure that Plan 02 will use when refactoring components. Buttons get keyboard accessibility (focus-visible), sidebar respects reduced-motion, and the no-transitions guard prevents color flash on page load.

Output: transitions.css with utilities + global reduced-motion, updated buttons.css with focus-visible, updated responsive.css with reduced-motion, updated index.html with no-transitions class.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-visual-polish/09-RESEARCH.md

@apps/web/src/styles/buttons.css
@apps/web/src/styles/responsive.css
@apps/web/src/styles/skeleton.css
@apps/web/src/styles/theme-variables.css
@apps/web/src/main.tsx
@apps/web/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create transitions.css with utility classes and global reduced-motion override</name>
  <files>apps/web/src/styles/transitions.css, apps/web/src/main.tsx</files>
  <action>
Create `apps/web/src/styles/transitions.css` with:

1. **Transition utility classes** (consistent timing across the app):
   - `.transition-colors` — `transition-property: background-color, border-color, color, fill; transition-duration: 200ms; transition-timing-function: ease;`
   - `.transition-transform` — `transition-property: transform; transition-duration: 200ms; transition-timing-function: ease;`
   - `.transition-shadow` — `transition-property: box-shadow; transition-duration: 200ms; transition-timing-function: ease;`
   - `.transition-opacity` — `transition-property: opacity; transition-duration: 150ms; transition-timing-function: ease;`
   - `.transition-interactive` — combined: `transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;`

2. **Image card CSS class** (replaces inline styles in Plan 02):
   - `.image-card` — `position: relative; cursor: pointer; border-radius: 8px; overflow: hidden; border: 1px solid var(--color-border); transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;`
   - `.image-card:hover, .image-card:focus-within` — `transform: scale(1.02); box-shadow: 0 4px 6px -1px var(--color-shadow); border-color: var(--color-accent);`
   - `.image-card.selected` — `border: 3px solid var(--color-accent);`
   - Reduced-motion override for `.image-card`: keep `box-shadow` and `border-color` transitions but disable `transform` (set `transition: box-shadow 0.2s ease, border-color 0.2s ease;` and `transform: none` on hover)

3. **Theme transition rule** (used by Plan 02 for smooth theme switching):
   - `body.theme-transitioning *` — `transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, fill 0.3s ease !important;`
   - This class is added/removed by JS during theme switch only

4. **Global reduced-motion override** (catch-all safety net):
   ```css
   @media (prefers-reduced-motion: reduce) {
     *, *::before, *::after {
       animation-duration: 0.01ms !important;
       animation-iteration-count: 1 !important;
       transition-duration: 0.01ms !important;
     }
   }
   ```

5. **No-transitions guard** (prevents FOUC on page load):
   ```css
   .no-transitions *, .no-transitions *::before, .no-transitions *::after {
     transition: none !important;
   }
   ```

Then add `import './styles/transitions.css'` to `apps/web/src/main.tsx` AFTER the theme-variables.css import (order matters — transitions.css must load after theme variables are defined).

Follow the pattern established in skeleton.css for reduced-motion support. Use CSS variables from theme-variables.css (e.g., `var(--color-shadow)`, `var(--color-accent)`, `var(--color-border)`).
  </action>
  <verify>
1. `cat apps/web/src/styles/transitions.css` — file exists with all utility classes, image-card class, theme-transitioning rule, global reduced-motion override, and no-transitions guard
2. `grep "transitions.css" apps/web/src/main.tsx` — import exists
3. `grep "prefers-reduced-motion" apps/web/src/styles/transitions.css` — reduced-motion media query present
4. `grep "no-transitions" apps/web/src/styles/transitions.css` — FOUC guard present
5. `grep "theme-transitioning" apps/web/src/styles/transitions.css` — theme transition class present
  </verify>
  <done>transitions.css exists with utility classes (.transition-colors, .transition-transform, .transition-shadow, .transition-opacity, .transition-interactive), .image-card hover/focus-within/selected/reduced-motion styles, .theme-transitioning rule, global prefers-reduced-motion override, and .no-transitions guard. File is imported in main.tsx after theme-variables.css.</done>
</task>

<task type="auto">
  <name>Task 2: Add focus-visible states to buttons.css and reduced-motion to responsive.css</name>
  <files>apps/web/src/styles/buttons.css, apps/web/src/styles/responsive.css, apps/web/index.html</files>
  <action>
**buttons.css — Add :focus-visible states matching existing :hover states:**

For each button class, add `:focus-visible` alongside existing `:hover`:

1. `.btn-primary:hover` → `.btn-primary:hover, .btn-primary:focus-visible` (same styles)
   - Add: `.btn-primary:focus-visible { outline: 2px solid var(--color-accent); outline-offset: 2px; }`

2. `.btn-secondary:hover` → `.btn-secondary:hover, .btn-secondary:focus-visible` (same styles)
   - Add: `.btn-secondary:focus-visible { outline: 2px solid var(--color-accent); outline-offset: 2px; }`

3. `.btn-danger:hover` → `.btn-danger:hover, .btn-danger:focus-visible` (same styles)
   - Add: `.btn-danger:focus-visible { outline: 2px solid var(--color-danger); outline-offset: 2px; }`

4. `.btn-success:hover` → `.btn-success:hover, .btn-success:focus-visible` (same styles)
   - Add: `.btn-success:focus-visible { outline: 2px solid var(--color-success); outline-offset: 2px; }`

5. `.btn-warning:hover` → `.btn-warning:hover, .btn-warning:focus-visible` (same styles)
   - Add: `.btn-warning:focus-visible { outline: 2px solid var(--color-warning); outline-offset: 2px; }`

6. `.btn-icon:hover` → `.btn-icon:hover, .btn-icon:focus-visible` (same styles)
   - Add: `.btn-icon:focus-visible { outline: 2px solid var(--color-accent); outline-offset: 2px; }`

Also add at the top of buttons.css (after existing rules):
```css
/* Remove default focus outline, use focus-visible instead */
.btn-primary:focus:not(:focus-visible),
.btn-secondary:focus:not(:focus-visible),
.btn-danger:focus:not(:focus-visible),
.btn-success:focus:not(:focus-visible),
.btn-warning:focus:not(:focus-visible),
.btn-icon:focus:not(:focus-visible) {
  outline: none;
}
```

**responsive.css — Add prefers-reduced-motion for sidebar:**

Add at the end of responsive.css:
```css
@media (prefers-reduced-motion: reduce) {
  .sidebar {
    transition: none;
  }
}
```

This ensures the sidebar slide-in animation (currently `transition: left 0.3s ease`) is disabled for users with reduced-motion preference. The sidebar will still open/close, just instantly.

**index.html — Add no-transitions class to prevent FOUC:**

In the inline `<script>` in index.html, add `document.documentElement.classList.add('no-transitions');` at the END of the IIFE (after theme is applied). This prevents any transitions from firing during initial page load.

Then add a small script at the end of `<body>` (before the module script) OR append to the existing IIFE:
```javascript
// Remove no-transitions after first paint
requestAnimationFrame(function() {
  requestAnimationFrame(function() {
    document.documentElement.classList.remove('no-transitions');
  });
});
```

The double-rAF ensures the browser has painted at least one frame before enabling transitions. This is more reliable than setTimeout(0).
  </action>
  <verify>
1. `grep "focus-visible" apps/web/src/styles/buttons.css` — focus-visible states present for all button types
2. `grep "outline:" apps/web/src/styles/buttons.css` — outline styles present
3. `grep "prefers-reduced-motion" apps/web/src/styles/responsive.css` — reduced-motion media query present
4. `grep "no-transitions" apps/web/index.html` — no-transitions class added in inline script
5. `grep "requestAnimationFrame" apps/web/index.html` — double-rAF removal present
6. Build check: `cd apps/web && npx tsc --noEmit` passes (no TS errors from HTML changes)
  </verify>
  <done>All button classes have matching :focus-visible states with colored outline rings. Mouse clicks show no outline (focus:not(:focus-visible)). Sidebar transition respects prefers-reduced-motion. Page load suppresses transitions via no-transitions class with double-rAF removal.</done>
</task>

</tasks>

<verification>
1. Open app in browser, Tab through buttons — each shows a colored focus ring
2. Click buttons with mouse — no focus ring appears (focus:not(:focus-visible) suppresses it)
3. Enable "Reduce motion" in OS accessibility settings — sidebar opens instantly, no hover scale on cards
4. Reload page in dark mode — no color flash during load (no-transitions guard active)
5. Inspect transitions.css — all utility classes present, image-card class ready for Plan 02
6. Both light and dark themes render correctly with no visual regressions
</verification>

<success_criteria>
- transitions.css exists with utility classes, image-card styles, theme-transitioning rule, global reduced-motion override, and no-transitions guard
- All 6 button classes have :focus-visible states with appropriate outline colors
- Sidebar transition has prefers-reduced-motion: reduce override
- index.html adds no-transitions class on load and removes it after first paint
- No build errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-visual-polish/09-01-SUMMARY.md`
</output>
