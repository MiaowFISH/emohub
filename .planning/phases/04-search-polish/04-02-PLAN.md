---
phase: 04-search-polish
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - apps/web/src/routes/index.tsx
  - apps/web/src/components/TagFilter.tsx
  - apps/web/src/components/ImageGrid.tsx
  - apps/web/src/styles/responsive.css
  - apps/web/src/main.tsx
autonomous: false

must_haves:
  truths:
    - "On mobile (<768px), sidebar is hidden behind a hamburger menu button"
    - "On mobile, tapping hamburger opens sidebar as an overlay with backdrop"
    - "On mobile, tapping backdrop or a tag closes the sidebar overlay"
    - "On tablet (768-1023px), sidebar is narrower (200px) but always visible"
    - "On desktop (>=1024px), sidebar is 240px and always visible"
    - "Image grid adjusts column count based on screen width"
    - "Upload area, search bar, and toolbar remain usable on all screen sizes"
  artifacts:
    - path: "apps/web/src/styles/responsive.css"
      provides: "Media query breakpoints and responsive classes"
      contains: "@media"
    - path: "apps/web/src/routes/index.tsx"
      provides: "Responsive layout with mobile sidebar toggle"
      contains: "sidebarOpen"
    - path: "apps/web/src/components/TagFilter.tsx"
      provides: "Responsive sidebar that works as overlay on mobile"
      contains: "onClose"
  key_links:
    - from: "apps/web/src/routes/index.tsx"
      to: "apps/web/src/components/TagFilter.tsx"
      via: "sidebarOpen state and onClose callback"
      pattern: "sidebarOpen"
    - from: "apps/web/src/styles/responsive.css"
      to: "apps/web/src/routes/index.tsx"
      via: "CSS classes applied to layout elements"
      pattern: "className"
---

<objective>
Make the web interface responsive across mobile, tablet, and desktop screen sizes, with collapsible sidebar on mobile.

Purpose: Fulfills UX-01 (responsive layout). Also serves as the final human verification checkpoint for all Phase 4 requirements (SRCH-01, SRCH-02, UX-01).
Output: Responsive layout that adapts to all screen sizes, verified by human.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-search-polish/04-RESEARCH.md
@.planning/phases/04-search-polish/04-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Responsive layout with mobile sidebar, CSS breakpoints, and adaptive grid</name>
  <files>
    apps/web/src/styles/responsive.css
    apps/web/src/main.tsx
    apps/web/src/routes/index.tsx
    apps/web/src/components/TagFilter.tsx
    apps/web/src/components/ImageGrid.tsx
  </files>
  <action>
    1. Create `apps/web/src/styles/responsive.css` with media query breakpoints:
       - Base (mobile-first): sidebar hidden off-screen, hamburger button visible, main content full width.
       - `@media (min-width: 768px)`: sidebar visible (200px width), hamburger hidden, main content adjusts.
       - `@media (min-width: 1024px)`: sidebar 240px width.
       - Overlay backdrop class for mobile sidebar (fixed, inset 0, semi-transparent black).
       - Sidebar transition: `left 0.3s ease` for smooth slide-in on mobile.

    2. In `apps/web/src/main.tsx`, import the CSS file: `import './styles/responsive.css'`.

    3. Refactor `apps/web/src/routes/index.tsx`:
       - Add `sidebarOpen` state (boolean, default false) and `isMobile` detection via `window.innerWidth < 768` with resize listener.
       - On mobile: show a hamburger button (top-left, z-index 1001) that toggles `sidebarOpen`.
       - On mobile when `sidebarOpen`: show backdrop overlay that closes sidebar on click.
       - Pass `isOpen={sidebarOpen}` and `onClose={() => setSidebarOpen(false)}` props to TagFilter.
       - Use CSS classes from responsive.css for layout structure instead of all inline styles.
       - Ensure SearchBar, ImageUpload, and ImageToolbar stack vertically on mobile with appropriate padding.
       - Header area (upload + manage tags + search) should wrap on narrow screens.

    4. Update `apps/web/src/components/TagFilter.tsx`:
       - Accept optional `onClose?: () => void` prop.
       - When a tag checkbox is toggled on mobile, call `onClose?.()` to auto-close the sidebar overlay (better UX).
       - Remove hardcoded `width: 240px` from inline styles — let CSS classes control width via responsive.css.
       - Add appropriate CSS class names for responsive targeting.

    5. In `apps/web/src/components/ImageGrid.tsx`:
       - The existing ResizeObserver already handles column count dynamically based on container width, so the grid is already responsive. Verify the minimum column calculation works well on mobile (should be 2 columns minimum at 200px per column). If the container is very narrow (<400px), allow 1 column.
       - Adjust the min column width calculation: `Math.max(Math.floor(width / 180), 1)` to allow single column on very narrow screens.

    Important: Use CSS media queries for layout changes, not JS window resize for everything. The `isMobile` JS detection is only needed for the hamburger button behavior and sidebar overlay logic. Use CSS classes for visual changes (sidebar width, visibility, grid adjustments).
  </action>
  <verify>
    Run `cd /opt/.openclaw/workspace/external/emohub && bun run --filter web build` to verify no build errors. Check that responsive.css is imported and classes are applied.
  </verify>
  <done>
    Layout adapts to mobile (<768px: hamburger + overlay sidebar), tablet (768-1023px: 200px sidebar), and desktop (>=1024px: 240px sidebar). Image grid adjusts columns. All controls remain accessible on all sizes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Human verification of all Phase 4 requirements (SRCH-01, SRCH-02, UX-01)</name>
  <action>
    Present the verification checklist to the user. All automated work is complete — this checkpoint confirms everything works end-to-end.
  </action>
  <verify>
    User runs through the verification steps below and confirms all pass.
  </verify>
  <done>
    User types "approved" confirming SRCH-01, SRCH-02, and UX-01 all pass.
  </done>
  <what-built>
    Complete Phase 4: Search functionality (SRCH-01, SRCH-02) and responsive layout (UX-01).

    Search: SearchBar with debounced input filters images by filename or tag name. Works alongside tag filter with AND logic.

    Responsive: Mobile gets hamburger menu with slide-out sidebar overlay. Tablet gets narrower sidebar. Desktop unchanged. Grid columns adapt to screen width.
  </what-built>
  <how-to-verify>
    Start the dev server: `bun run dev` (from project root)

    **Search (SRCH-01 + SRCH-02):**
    1. Upload a few images if none exist, tag some with known names
    2. Type a tag name in the search bar — verify matching images appear after ~400ms
    3. Type part of a filename — verify matching images appear
    4. Combine: select a tag filter in sidebar AND type a search term — verify both filters apply (AND logic)
    5. Clear search — verify all images (or tag-filtered set) return
    6. Scroll down with search active — verify infinite scroll still works

    **Responsive (UX-01):**
    7. Open browser DevTools, toggle device toolbar (Ctrl+Shift+M)
    8. Set to mobile width (~375px): verify hamburger button appears, sidebar is hidden
    9. Tap hamburger: verify sidebar slides in as overlay with dark backdrop
    10. Tap a tag or backdrop: verify sidebar closes
    11. Set to tablet width (~800px): verify sidebar is visible but narrower
    12. Set to desktop width (~1200px): verify sidebar is full 240px width
    13. Verify image grid adjusts columns at each breakpoint
    14. Verify upload, search, and toolbar are usable at mobile width
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. Web app builds without errors
2. CSS file imported and media queries active
3. Mobile: hamburger visible, sidebar hidden, overlay works
4. Tablet: sidebar visible at 200px
5. Desktop: sidebar visible at 240px
6. Grid columns adapt to screen width
7. All Phase 4 requirements verified by human
</verification>

<success_criteria>
- UX-01: Web interface adapts to mobile, tablet, and desktop screen sizes
- SRCH-01 + SRCH-02 confirmed working (from Plan 01, verified here)
- No regressions in existing functionality
- All three Phase 4 requirements pass human verification
</success_criteria>

<output>
After completion, create `.planning/phases/04-search-polish/04-02-SUMMARY.md`
</output>
