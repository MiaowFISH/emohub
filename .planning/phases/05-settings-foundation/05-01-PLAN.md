---
phase: 05-settings-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/stores/settingsStore.ts
  - apps/web/src/components/SettingsForm.tsx
  - apps/web/src/routes/settings.tsx
  - apps/web/src/routes/__root.tsx
  - apps/web/src/styles/theme-variables.css
  - apps/web/src/main.tsx
autonomous: true

must_haves:
  truths:
    - "User can navigate to /settings from the header navigation"
    - "User can select theme preference (light/dark/system) via radio buttons"
    - "User can select language preference (en/zh) via dropdown"
    - "Setting changes apply instantly without page refresh or submit button"
    - "Settings persist across browser sessions (survives page reload)"
    - "Settings page is usable on both mobile and desktop layouts"
  artifacts:
    - path: "apps/web/src/stores/settingsStore.ts"
      provides: "Zustand store with persist middleware for theme and language preferences"
      exports: ["useSettingsStore"]
    - path: "apps/web/src/components/SettingsForm.tsx"
      provides: "Immediate-feedback settings form with radio buttons and select"
      exports: ["SettingsForm"]
    - path: "apps/web/src/routes/settings.tsx"
      provides: "Settings page route at /settings"
      exports: ["Route"]
    - path: "apps/web/src/styles/theme-variables.css"
      provides: "CSS custom properties for theme switching (Phase 6 prep)"
      contains: "--color-bg-primary"
  key_links:
    - from: "apps/web/src/components/SettingsForm.tsx"
      to: "apps/web/src/stores/settingsStore.ts"
      via: "useSettingsStore hook"
      pattern: "useSettingsStore\\(\\)"
    - from: "apps/web/src/routes/settings.tsx"
      to: "apps/web/src/components/SettingsForm.tsx"
      via: "SettingsForm component import"
      pattern: "import.*SettingsForm"
    - from: "apps/web/src/routes/__root.tsx"
      to: "/settings"
      via: "TanStack Router Link component"
      pattern: "Link.*to=.*settings"
    - from: "apps/web/src/stores/settingsStore.ts"
      to: "localStorage"
      via: "Zustand persist middleware"
      pattern: "persist.*emohub-settings"
---

<objective>
Create the settings infrastructure for EmoHub: a persisted settings store, a settings page with immediate-feedback form, navigation from the header, and CSS variable groundwork for Phase 6 dark mode.

Purpose: Phase 5 is the foundation for dark mode (Phase 6) and i18n (Phase 7). The settings store and page must exist before those features can be built.
Output: Working /settings page with theme and language preferences that persist to localStorage.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-settings-foundation/05-RESEARCH.md

@apps/web/src/stores/tagStore.ts
@apps/web/src/routes/__root.tsx
@apps/web/src/routes/index.tsx
@apps/web/src/styles/responsive.css
@apps/web/src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create settings store with persist middleware</name>
  <files>apps/web/src/stores/settingsStore.ts</files>
  <action>
Create a Zustand store following the same pattern as tagStore.ts and imageStore.ts (import from 'zustand', typed interface, create()).

Store interface `SettingsState`:
- `theme: 'light' | 'dark' | 'system'` (default: `'system'`)
- `language: 'en' | 'zh'` (default: `'zh'` — this is a Chinese emoji tool)
- `setTheme: (theme: 'light' | 'dark' | 'system') => void`
- `setLanguage: (language: 'en' | 'zh') => void`

Wrap with `persist` middleware from `zustand/middleware`:
- Storage key: `'emohub-settings'`
- Use `createJSONStorage(() => localStorage)`
- Use `partialize` to persist only `theme` and `language` (not the setter functions)

Export as `useSettingsStore`.
  </action>
  <verify>
Run `cd /opt/.openclaw/workspace/external/emohub && npx tsc --noEmit` — no type errors in settingsStore.ts.
Verify the file exports useSettingsStore and uses persist middleware.
  </verify>
  <done>settingsStore.ts exists, exports useSettingsStore, persists theme and language to localStorage under 'emohub-settings' key, defaults to system theme and zh language.</done>
</task>

<task type="auto">
  <name>Task 2: Create settings page route and form component</name>
  <files>apps/web/src/components/SettingsForm.tsx, apps/web/src/routes/settings.tsx</files>
  <action>
**SettingsForm.tsx:**
Create a form component that reads and writes settings via `useSettingsStore()`. Follow the inline styles pattern used throughout the codebase (no CSS modules, no Tailwind).

Layout:
- Two sections: "Appearance" (theme) and "Language"
- Theme section: `fieldset` with `legend` "Theme", three radio buttons (Light, Dark, System) — each in a `label` with `input type="radio" name="theme"`
- Language section: `label` wrapping a `select` with two options: English, 中文
- No submit button — onChange handlers call setTheme/setLanguage directly (SET-02: immediate effect)
- Use semantic HTML: `fieldset`, `legend`, `label` for accessibility
- Style with inline styles matching existing codebase patterns (system-ui font, #e5e7eb borders, #f9fafb backgrounds)
- Responsive: max-width 600px, full width on mobile

**settings.tsx:**
Create file-based route using `createFileRoute('/settings')` following the same pattern as index.tsx.
- Import and render SettingsForm
- Page title "Settings" as h1
- Centered layout with max-width 600px, padding 2rem
  </action>
  <verify>
Run `cd /opt/.openclaw/workspace/external/emohub && npx tsc --noEmit` — no type errors.
Verify settings.tsx exports Route and SettingsForm.tsx exports SettingsForm.
  </verify>
  <done>Settings page renders at /settings with theme radio buttons and language dropdown. Changing any setting updates the store immediately (no submit button). Form uses semantic HTML (fieldset, legend, label) for accessibility.</done>
</task>

<task type="auto">
  <name>Task 3: Add navigation link and CSS variables</name>
  <files>apps/web/src/routes/__root.tsx, apps/web/src/styles/theme-variables.css, apps/web/src/main.tsx</files>
  <action>
**__root.tsx modifications:**
- Import `Link` from `@tanstack/react-router` (add to existing import)
- Convert the header to include a `nav` element with flex layout
- Make "EmoHub" title a `Link to="/"` (unstyled, color inherit)
- Add a settings icon/link: `Link to="/settings"` with a gear SVG icon (24x24, stroke currentColor) and sr-only text "Settings"
- Position the settings link on the right side of the header (use marginLeft: 'auto')
- Use CSS variable references where possible: `var(--color-border, #e5e7eb)` for border, `var(--color-bg-secondary, #f9fafb)` for header background — fallback values ensure it works before Phase 6

**theme-variables.css:**
Create CSS custom properties file defining the light theme as defaults on `:root`:
```
--color-bg-primary: #ffffff
--color-bg-secondary: #f9fafb
--color-text-primary: #111827
--color-text-secondary: #6b7280
--color-border: #e5e7eb
--color-accent: #3b82f6
--color-accent-hover: #2563eb
```
Add a `[data-theme='dark']` block with dark values (Phase 6 will activate this):
```
--color-bg-primary: #1f2937
--color-bg-secondary: #111827
--color-text-primary: #f9fafb
--color-text-secondary: #d1d5db
--color-border: #374151
--color-accent: #60a5fa
--color-accent-hover: #93c5fd
```

**main.tsx:**
Add `import './styles/theme-variables.css'` alongside the existing responsive.css import.
  </action>
  <verify>
Run `cd /opt/.openclaw/workspace/external/emohub && npx tsc --noEmit` — no type errors.
Verify __root.tsx imports Link and has a Link to="/settings".
Verify theme-variables.css defines :root and [data-theme='dark'] blocks.
Verify main.tsx imports theme-variables.css.
  </verify>
  <done>Header shows EmoHub title (links to /) and a settings gear icon (links to /settings). CSS variables defined for light/dark themes. Header uses CSS variable references with fallbacks. theme-variables.css imported in main.tsx.</done>
</task>

</tasks>

<verification>
1. `cd /opt/.openclaw/workspace/external/emohub && npx tsc --noEmit` passes with zero errors
2. Route tree regenerates to include /settings route
3. settingsStore.ts uses persist middleware with partialize
4. SettingsForm.tsx uses useSettingsStore and has no submit button
5. __root.tsx has Link to="/settings" in header
6. theme-variables.css defines CSS custom properties for both light and dark themes
7. main.tsx imports theme-variables.css
</verification>

<success_criteria>
- Navigating to /settings shows a settings page with theme and language controls
- Changing theme radio button updates settingsStore immediately
- Changing language dropdown updates settingsStore immediately
- Refreshing the page preserves the selected settings (localStorage persistence)
- Header navigation shows EmoHub link and settings icon on all pages
- CSS variables are defined and ready for Phase 6 dark mode activation
- Settings page is accessible with keyboard navigation and screen readers
</success_criteria>

<output>
After completion, create `.planning/phases/05-settings-foundation/05-01-SUMMARY.md`
</output>
