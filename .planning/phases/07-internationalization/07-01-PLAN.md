---
phase: 07-internationalization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/package.json
  - apps/web/src/i18n/config.ts
  - apps/web/src/i18n/i18next.d.ts
  - apps/web/public/locales/en/common.json
  - apps/web/public/locales/en/settings.json
  - apps/web/public/locales/en/images.json
  - apps/web/public/locales/zh/common.json
  - apps/web/public/locales/zh/settings.json
  - apps/web/public/locales/zh/images.json
  - apps/web/src/stores/settingsStore.ts
  - apps/web/src/main.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "i18next initializes with 'zh' as default language matching existing settingsStore default"
    - "Language changes in settingsStore propagate to i18next and vice versa"
    - "Translation files load asynchronously from /locales/{lng}/{ns}.json"
    - "TypeScript provides autocomplete for translation keys"
  artifacts:
    - path: "apps/web/src/i18n/config.ts"
      provides: "i18next initialization with react-i18next, http-backend, language detector"
      exports: ["default (i18n instance)"]
    - path: "apps/web/src/i18n/i18next.d.ts"
      provides: "TypeScript type augmentation for translation keys"
      contains: "CustomTypeOptions"
    - path: "apps/web/public/locales/en/common.json"
      provides: "English translations for shared UI (nav, buttons, status)"
    - path: "apps/web/public/locales/zh/common.json"
      provides: "Chinese translations for shared UI"
    - path: "apps/web/public/locales/en/settings.json"
      provides: "English translations for settings page"
    - path: "apps/web/public/locales/zh/settings.json"
      provides: "Chinese translations for settings page"
    - path: "apps/web/public/locales/en/images.json"
      provides: "English translations for image management (toolbar, upload, grid, tags, modals)"
    - path: "apps/web/public/locales/zh/images.json"
      provides: "Chinese translations for image management"
  key_links:
    - from: "apps/web/src/i18n/config.ts"
      to: "apps/web/src/stores/settingsStore.ts"
      via: "i18n.on('languageChanged') syncs to store, store initial language seeds i18n"
      pattern: "i18n\\.on\\('languageChanged'"
    - from: "apps/web/src/main.tsx"
      to: "apps/web/src/i18n/config.ts"
      via: "import side-effect before RouterProvider renders"
      pattern: "import.*i18n/config"
    - from: "apps/web/src/i18n/config.ts"
      to: "apps/web/public/locales"
      via: "i18next-http-backend loadPath"
      pattern: "loadPath.*locales"
---

<objective>
Set up i18next infrastructure and create all translation files for Chinese/English.

Purpose: Establish the i18n foundation so Plan 02 can convert components to use `useTranslation()` hooks. This plan installs dependencies, configures i18next with the existing settings store, and creates complete translation JSON files covering every hardcoded string in the app.

Output: Working i18next config, 6 translation JSON files (3 namespaces x 2 languages), TypeScript type definitions, and bidirectional sync between i18next and settingsStore.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/web/src/stores/settingsStore.ts
@apps/web/src/main.tsx
@apps/web/package.json
@apps/web/vite.config.ts
@apps/web/tsconfig.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install i18next dependencies and create config with store sync</name>
  <files>
    apps/web/package.json
    apps/web/src/i18n/config.ts
    apps/web/src/i18n/i18next.d.ts
    apps/web/src/stores/settingsStore.ts
    apps/web/src/main.tsx
  </files>
  <action>
1. Install dependencies from `apps/web/`:
   ```bash
   cd apps/web && npm install i18next react-i18next i18next-http-backend i18next-browser-languagedetector
   ```

2. Create `src/i18n/config.ts`:
   - Import i18next, initReactI18next, Backend (i18next-http-backend), LanguageDetector (i18next-browser-languagedetector)
   - Import useSettingsStore from `@/stores/settingsStore`
   - Chain: `i18n.use(Backend).use(LanguageDetector).use(initReactI18next).init({...})`
   - Config:
     - `fallbackLng: 'zh'`
     - `supportedLngs: ['en', 'zh']`
     - `defaultNS: 'common'`
     - `ns: ['common', 'settings', 'images']`
     - `detection.order: ['localStorage', 'navigator']` — but we override with store value below
     - `backend.loadPath: '/locales/{{lng}}/{{ns}}.json'`
     - `interpolation.escapeValue: false` (React already escapes)
     - `react.useSuspense: true`
   - After init, sync bidirectionally:
     - `i18n.on('languageChanged', (lng) => useSettingsStore.getState().setLanguage(lng as 'en' | 'zh'))`
     - Read initial language from store: `const initialLang = useSettingsStore.getState().language; if (initialLang) i18n.changeLanguage(initialLang)`
   - Export default i18n

3. Create `src/i18n/i18next.d.ts`:
   - Augment `i18next` module with `CustomTypeOptions`:
     - `defaultNS: 'common'`
     - `resources` typed from the English JSON imports (common, settings, images)
   - This enables autocomplete for `t('key')` calls

4. Update `src/stores/settingsStore.ts`:
   - In the `setLanguage` action, after `set({ language })`, also call `i18n.changeLanguage(language)` to keep i18next in sync when language is changed from the settings UI
   - Import i18n lazily to avoid circular dependency: use dynamic import or import the i18n instance and call changeLanguage
   - IMPORTANT: To avoid circular imports (settingsStore imports i18n, i18n imports settingsStore), use this pattern in settingsStore: do NOT import i18n directly. Instead, add a subscriber in config.ts that watches store language changes. The store itself stays unchanged. The bidirectional sync lives entirely in config.ts:
     - `i18n.on('languageChanged')` -> updates store
     - `useSettingsStore.subscribe((state) => { if (state.language !== i18n.language) i18n.changeLanguage(state.language) })` -> updates i18n
   - This means settingsStore.ts does NOT need modification for sync. Keep it as-is.

5. Update `src/main.tsx`:
   - Add `import '@/i18n/config'` BEFORE the router import (side-effect import ensures i18n initializes before any component renders)
   - Wrap `<RouterProvider>` in `<Suspense fallback={<div>...</div>}>` from React (required for async translation loading with useSuspense: true)
   - Import Suspense from 'react'
  </action>
  <verify>
    - `cd apps/web && npx tsc --noEmit` passes without errors
    - `ls apps/web/node_modules/i18next apps/web/node_modules/react-i18next apps/web/node_modules/i18next-http-backend apps/web/node_modules/i18next-browser-languagedetector` all exist
    - `apps/web/src/i18n/config.ts` exists and exports default i18n instance
  </verify>
  <done>i18next is configured with http-backend, language detector, and bidirectional sync with settingsStore. main.tsx imports i18n config before rendering and wraps app in Suspense.</done>
</task>

<task type="auto">
  <name>Task 2: Create complete translation files for all UI strings</name>
  <files>
    apps/web/public/locales/en/common.json
    apps/web/public/locales/en/settings.json
    apps/web/public/locales/en/images.json
    apps/web/public/locales/zh/common.json
    apps/web/public/locales/zh/settings.json
    apps/web/public/locales/zh/images.json
  </files>
  <action>
Create `apps/web/public/` directory and all locale subdirectories.

**Namespace organization:**
- `common` — shared UI: nav, generic buttons (Cancel, Delete, Save, Apply, Clear, Add), status text (Loading, Processing), app name
- `settings` — settings page: section titles (Appearance, Language), theme options (Light, Dark, System), language labels
- `images` — everything in image management: toolbar, upload, grid, search, tag filter, tag input, tag manager, batch tag modal, lightbox, confirmations

**English `common.json`:**
```json
{
  "app_name": "EmoHub",
  "nav": {
    "settings": "Settings"
  },
  "actions": {
    "cancel": "Cancel",
    "delete": "Delete",
    "save": "Save",
    "add": "Add",
    "apply": "Apply",
    "clear": "Clear",
    "remove": "Remove",
    "rename": "Rename",
    "close": "Close"
  },
  "status": {
    "loading": "Loading...",
    "processing": "Processing...",
    "deleting": "Deleting..."
  }
}
```

**Chinese `common.json`:**
```json
{
  "app_name": "EmoHub",
  "nav": {
    "settings": "设置"
  },
  "actions": {
    "cancel": "取消",
    "delete": "删除",
    "save": "保存",
    "add": "添加",
    "apply": "应用",
    "clear": "清除",
    "remove": "移除",
    "rename": "重命名",
    "close": "关闭"
  },
  "status": {
    "loading": "加载中...",
    "processing": "处理中...",
    "deleting": "删除中..."
  }
}
```

**English `settings.json`:**
```json
{
  "title": "Settings",
  "appearance": {
    "title": "Appearance",
    "light": "Light",
    "dark": "Dark",
    "system": "System"
  },
  "language": {
    "title": "Language",
    "select": "Select language",
    "chinese": "中文",
    "english": "English"
  }
}
```

**Chinese `settings.json`:**
```json
{
  "title": "设置",
  "appearance": {
    "title": "外观",
    "light": "浅色",
    "dark": "深色",
    "system": "跟随系统"
  },
  "language": {
    "title": "语言",
    "select": "选择语言",
    "chinese": "中文",
    "english": "English"
  }
}
```

**English `images.json`:**
```json
{
  "toolbar": {
    "selected_count": "{{count}} selected",
    "select_all": "Select All",
    "add_tags": "Add Tags",
    "remove_tags": "Remove Tags",
    "convert_to_gif": "Convert to GIF",
    "converting": "Converting...",
    "download_gif": "Download GIF",
    "downloading": "Downloading...",
    "confirm_delete_title": "Confirm Delete",
    "confirm_delete_message": "Delete {{count}} image(s)? This cannot be undone.",
    "delete_failed": "Failed to delete images: {{error}}"
  },
  "upload": {
    "uploading": "Uploading...",
    "drop_here": "Drop images here",
    "drag_or_click": "Drag and drop images here, or click to select",
    "supported_formats": "Supports JPG, PNG, WebP, GIF (max 10MB)",
    "duplicate": "(duplicate)"
  },
  "grid": {
    "no_images": "No images yet. Upload some stickers!",
    "more_tags": "+{{count}} more"
  },
  "search": {
    "placeholder": "Search by filename or tag...",
    "aria_label": "Search images"
  },
  "filter": {
    "title": "Filter by Tags",
    "showing_count": "Showing images with {{count}} tag(s)",
    "no_tags": "No tags yet",
    "toggle_menu": "Toggle menu"
  },
  "tag_input": {
    "placeholder": "Add tags...",
    "no_options": "No matching tags"
  },
  "tag_manager": {
    "title": "Manage Tags",
    "new_tag_placeholder": "New tag name...",
    "no_tags": "No tags yet. Create one above!",
    "image_count_one": "{{count}} image",
    "image_count_other": "{{count}} images",
    "delete_tag_title": "Delete Tag?",
    "delete_tag_message": "This tag is used on {{count}} image(s). Remove it?"
  },
  "batch_tag": {
    "add_title": "Add Tags to {{count}} Images",
    "remove_title": "Remove Tags from {{count}} Images",
    "add_placeholder": "Type to add tags...",
    "no_tags_available": "No tags available",
    "select_one_tag": "Please select at least one tag",
    "select_one_tag_remove": "Please select at least one tag to remove",
    "operation_failed": "Failed to {{mode}} tags: {{error}}"
  }
}
```

**Chinese `images.json`:**
```json
{
  "toolbar": {
    "selected_count": "已选择 {{count}} 项",
    "select_all": "全选",
    "add_tags": "添加标签",
    "remove_tags": "移除标签",
    "convert_to_gif": "转换为 GIF",
    "converting": "转换中...",
    "download_gif": "下载 GIF",
    "downloading": "下载中...",
    "confirm_delete_title": "确认删除",
    "confirm_delete_message": "删除 {{count}} 张图片？此操作无法撤销。",
    "delete_failed": "删除图片失败：{{error}}"
  },
  "upload": {
    "uploading": "上传中...",
    "drop_here": "将图片拖放到此处",
    "drag_or_click": "拖放图片到此处，或点击选择文件",
    "supported_formats": "支持 JPG、PNG、WebP、GIF（最大 10MB）",
    "duplicate": "（重复）"
  },
  "grid": {
    "no_images": "还没有图片，上传一些表情包吧！",
    "more_tags": "+{{count}} 更多"
  },
  "search": {
    "placeholder": "按文件名或标签搜索...",
    "aria_label": "搜索图片"
  },
  "filter": {
    "title": "按标签筛选",
    "showing_count": "显示包含 {{count}} 个标签的图片",
    "no_tags": "暂无标签",
    "toggle_menu": "切换菜单"
  },
  "tag_input": {
    "placeholder": "添加标签...",
    "no_options": "没有匹配的标签"
  },
  "tag_manager": {
    "title": "管理标签",
    "new_tag_placeholder": "新标签名称...",
    "no_tags": "暂无标签，在上方创建一个吧！",
    "image_count_one": "{{count}} 张图片",
    "image_count_other": "{{count}} 张图片",
    "delete_tag_title": "删除标签？",
    "delete_tag_message": "此标签已用于 {{count}} 张图片，确定移除吗？"
  },
  "batch_tag": {
    "add_title": "为 {{count}} 张图片添加标签",
    "remove_title": "从 {{count}} 张图片移除标签",
    "add_placeholder": "输入以添加标签...",
    "no_tags_available": "暂无可用标签",
    "select_one_tag": "请至少选择一个标签",
    "select_one_tag_remove": "请至少选择一个要移除的标签",
    "operation_failed": "{{mode}}标签失败：{{error}}"
  }
}
```

Note: Chinese does not distinguish singular/plural, so `image_count_one` and `image_count_other` are identical. i18next handles this correctly — Chinese always uses the `_other` form.

Ensure all JSON files are valid (no trailing commas, proper escaping). Every hardcoded string from every component must have a corresponding key.
  </action>
  <verify>
    - All 6 JSON files exist under `apps/web/public/locales/`
    - `node -e "require('./apps/web/public/locales/en/common.json')"` (and all 5 others) parse without error
    - English and Chinese files have identical key structures (same nesting, same keys)
    - `cd apps/web && npx tsc --noEmit` still passes
  </verify>
  <done>All 6 translation files exist with complete coverage of every UI string. English and Chinese have matching key structures. TypeScript type definitions reference the English files for autocomplete.</done>
</task>

</tasks>

<verification>
1. `cd apps/web && npx tsc --noEmit` — no type errors
2. `node -e "const fs=require('fs'); ['en','zh'].forEach(l=>['common','settings','images'].forEach(n=>{JSON.parse(fs.readFileSync('apps/web/public/locales/'+l+'/'+n+'.json','utf8'));console.log(l+'/'+n+': OK')}))"` — all 6 files parse
3. `grep -r "i18n/config" apps/web/src/main.tsx` — config imported before router
4. `grep -r "Suspense" apps/web/src/main.tsx` — Suspense wraps app
5. `grep -r "languageChanged" apps/web/src/i18n/config.ts` — bidirectional sync exists
</verification>

<success_criteria>
- i18next, react-i18next, i18next-http-backend, i18next-browser-languagedetector installed
- i18n config initializes with zh fallback, 3 namespaces, http-backend loading from /locales/
- Bidirectional sync: settingsStore.language <-> i18n.language (no circular imports)
- main.tsx imports i18n config before rendering, wraps in Suspense
- 6 translation JSON files with complete coverage of all UI strings
- TypeScript type definitions enable key autocomplete
- Build passes with no type errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-internationalization/07-01-SUMMARY.md`
</output>
