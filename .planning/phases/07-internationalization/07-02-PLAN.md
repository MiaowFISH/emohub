---
phase: 07-internationalization
plan: 02
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - apps/web/src/routes/__root.tsx
  - apps/web/src/routes/settings.tsx
  - apps/web/src/routes/index.tsx
  - apps/web/src/components/SettingsForm.tsx
  - apps/web/src/components/TagFilter.tsx
  - apps/web/src/components/SearchBar.tsx
  - apps/web/src/components/ImageToolbar.tsx
  - apps/web/src/components/ImageUpload.tsx
  - apps/web/src/components/ImageGrid.tsx
  - apps/web/src/components/TagInput.tsx
  - apps/web/src/components/BatchTagModal.tsx
  - apps/web/src/components/TagManager.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can switch language in settings and all UI text updates immediately"
    - "User's language preference persists across page refreshes"
    - "No hardcoded English or Chinese strings remain in any component"
    - "Pluralization works correctly (e.g., '1 image' vs '2 images' in English)"
  artifacts:
    - path: "apps/web/src/components/SettingsForm.tsx"
      provides: "Language selector that calls i18n.changeLanguage and syncs with store"
      contains: "useTranslation"
    - path: "apps/web/src/components/ImageToolbar.tsx"
      provides: "Toolbar with all translated strings including interpolation for counts"
      contains: "useTranslation"
    - path: "apps/web/src/components/TagManager.tsx"
      provides: "Tag manager modal with translated strings and pluralized image counts"
      contains: "useTranslation"
    - path: "apps/web/src/components/ImageUpload.tsx"
      provides: "Upload area with translated drag/drop text and status messages"
      contains: "useTranslation"
  key_links:
    - from: "apps/web/src/components/SettingsForm.tsx"
      to: "apps/web/src/i18n/config.ts"
      via: "useTranslation('settings') hook + i18n.changeLanguage on select"
      pattern: "i18n\\.changeLanguage"
    - from: "apps/web/src/components/ImageToolbar.tsx"
      to: "apps/web/public/locales/en/images.json"
      via: "useTranslation('images') with interpolation {{count}}"
      pattern: "t\\('toolbar\\."
    - from: "apps/web/src/components/TagManager.tsx"
      to: "apps/web/public/locales/en/images.json"
      via: "useTranslation('images') with pluralization for image counts"
      pattern: "t\\('tag_manager\\."
---

<objective>
Convert all components from hardcoded strings to i18n translation keys.

Purpose: Complete the internationalization by replacing every hardcoded UI string with `t()` calls from react-i18next. After this plan, switching language in settings instantly updates all visible text.

Output: All 12 component/route files use `useTranslation()` hooks with zero hardcoded user-facing strings remaining.
</objective>

<execution_context>
@/root/.claude/get-shit-done/workflows/execute-plan.md
@/root/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-internationalization/07-01-SUMMARY.md
@apps/web/public/locales/en/common.json
@apps/web/public/locales/en/settings.json
@apps/web/public/locales/en/images.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Convert routes and settings components to use translation keys</name>
  <files>
    apps/web/src/routes/__root.tsx
    apps/web/src/routes/settings.tsx
    apps/web/src/routes/index.tsx
    apps/web/src/components/SettingsForm.tsx
  </files>
  <action>
For each file, add `import { useTranslation } from 'react-i18next'` and destructure `const { t } = useTranslation('namespace')` (or `const { t, i18n } = ...` where language switching is needed).

**`__root.tsx`** — use `useTranslation('common')`:
- `"EmoHub"` -> `{t('app_name')}`
- `"Settings"` (sr-only span) -> `{t('nav.settings')}`
- The `aria-label="Settings"` on the Link -> `aria-label={t('nav.settings')}`

**`settings.tsx`** — use `useTranslation('settings')`:
- `"Settings"` (h1) -> `{t('title')}`

**`index.tsx`** — use `useTranslation('images')`:
- `"Manage Tags"` button text -> `{t('tag_manager.title')}`
- `"Toggle menu"` aria-label -> `aria-label={t('filter.toggle_menu')}`

**`SettingsForm.tsx`** — use `useTranslation('settings')` AND import `useTranslation` from react-i18next:
- `"Appearance"` legend -> `{t('appearance.title')}`
- `"Light"` / `"Dark"` / `"System"` spans -> `{t('appearance.light')}` / `{t('appearance.dark')}` / `{t('appearance.system')}`
- `"Language"` legend -> `{t('language.title')}`
- `"Select language"` sr-only -> `{t('language.select')}`
- `"中文"` option -> `{t('language.chinese')}`
- `"English"` option -> `{t('language.english')}`
- Update the language `<select>` onChange to also call `i18n.changeLanguage(value)`:
  ```tsx
  const { t, i18n } = useTranslation('settings')
  // In onChange:
  const handleLanguageChange = async (value: 'en' | 'zh') => {
    await i18n.changeLanguage(value)
    setLanguage(value)
  }
  ```
  This ensures i18next switches language immediately. The store sync in config.ts handles the rest.

Do NOT change any styling, layout, or non-text logic. Only replace string literals with `t()` calls.
  </action>
  <verify>
    - `cd apps/web && npx tsc --noEmit` passes
    - `grep -rn "\"Settings\"" apps/web/src/routes/ apps/web/src/components/SettingsForm.tsx` returns no matches (all hardcoded strings replaced)
    - `grep -rn "useTranslation" apps/web/src/routes/__root.tsx apps/web/src/routes/settings.tsx apps/web/src/routes/index.tsx apps/web/src/components/SettingsForm.tsx` shows all 4 files use the hook
  </verify>
  <done>All 4 route/settings files use translation keys. No hardcoded user-facing strings remain in these files. Language selector triggers i18n.changeLanguage for instant switching.</done>
</task>

<task type="auto">
  <name>Task 2: Convert all image management components to use translation keys</name>
  <files>
    apps/web/src/components/TagFilter.tsx
    apps/web/src/components/SearchBar.tsx
    apps/web/src/components/ImageToolbar.tsx
    apps/web/src/components/ImageUpload.tsx
    apps/web/src/components/ImageGrid.tsx
    apps/web/src/components/TagInput.tsx
    apps/web/src/components/BatchTagModal.tsx
    apps/web/src/components/TagManager.tsx
  </files>
  <action>
For each file, add `import { useTranslation } from 'react-i18next'` and use `const { t } = useTranslation('images')`.

**`TagFilter.tsx`:**
- `"Filter by Tags"` -> `{t('filter.title')}`
- `"Clear"` -> `{t('common:actions.clear')}` (cross-namespace reference using `common:` prefix)
- `` `Showing images with ${filterTagIds.size} tag(s)` `` -> `{t('filter.showing_count', { count: filterTagIds.size })}`
- `"No tags yet"` -> `{t('filter.no_tags')}`

**`SearchBar.tsx`:**
- `"Search by filename or tag..."` placeholder -> `t('search.placeholder')`
- `"Search images"` aria-label -> `t('search.aria_label')`

**`ImageToolbar.tsx`:**
- `` `${selectedIds.size} selected` `` -> `{t('toolbar.selected_count', { count: selectedIds.size })}`
- `"Select All"` -> `{t('toolbar.select_all')}`
- `"Clear"` -> `{t('common:actions.clear')}`
- `"Add Tags"` -> `{t('toolbar.add_tags')}`
- `"Remove Tags"` -> `{t('toolbar.remove_tags')}`
- `"Delete"` / `"Deleting..."` -> `{isDeleting ? t('common:status.deleting') : t('common:actions.delete')}`
- `"Convert to GIF"` / `"Converting..."` / `"Download GIF"` / `"Downloading..."` -> use appropriate keys: `{isConverting ? (isSelectedGif ? t('toolbar.downloading') : t('toolbar.converting')) : (isSelectedGif ? t('toolbar.download_gif') : t('toolbar.convert_to_gif'))}`
- `"Confirm Delete"` -> `{t('toolbar.confirm_delete_title')}`
- `` `Delete ${selectedIds.size} image(s)? This cannot be undone.` `` -> `{t('toolbar.confirm_delete_message', { count: selectedIds.size })}`
- `"Cancel"` buttons -> `{t('common:actions.cancel')}`
- Alert messages: `alert(t('toolbar.delete_failed', { error: ... }))` etc.

**`ImageUpload.tsx`:**
- `"Uploading..."` -> `{t('upload.uploading')}`
- `"Drop images here"` -> `{t('upload.drop_here')}`
- `"Drag and drop images here, or click to select"` -> `{t('upload.drag_or_click')}`
- `"Supports JPG, PNG, WebP, GIF (max 10MB)"` -> `{t('upload.supported_formats')}`
- `"(duplicate)"` -> `{t('upload.duplicate')}`

**`ImageGrid.tsx`:**
- `"Loading..."` -> `{t('common:status.loading')}`
- `"No images yet. Upload some stickers!"` -> `{t('grid.no_images')}`
- `` `+${image.tags.length - 3} more` `` -> `{t('grid.more_tags', { count: image.tags.length - 3 })}`

**`TagInput.tsx`:**
- `"Add tags..."` placeholderText -> `t('tag_input.placeholder')`
- `"No matching tags"` noOptionsText -> `t('tag_input.no_options')`

**`BatchTagModal.tsx`:**
- `` `Add Tags to ${imageIds.length} Images` `` -> `{t('batch_tag.add_title', { count: imageIds.length })}`
- `` `Remove Tags from ${imageIds.length} Images` `` -> `{t('batch_tag.remove_title', { count: imageIds.length })}`
- `"Type to add tags..."` -> `t('batch_tag.add_placeholder')`
- `"No matching tags"` -> `t('tag_input.no_options')`
- `"No tags available"` -> `{t('batch_tag.no_tags_available')}`
- `"Cancel"` -> `{t('common:actions.cancel')}`
- `"Processing..."` -> `{t('common:status.processing')}`
- `"Apply"` -> `{t('common:actions.apply')}`
- `"Remove"` -> `{t('common:actions.remove')}`
- Alert messages: use `t('batch_tag.select_one_tag')`, `t('batch_tag.select_one_tag_remove')`, `t('batch_tag.operation_failed', { mode: ..., error: ... })`

**`TagManager.tsx`:**
- `"Manage Tags"` h2 -> `{t('tag_manager.title')}`
- `"New tag name..."` placeholder -> `t('tag_manager.new_tag_placeholder')`
- `"Add"` button -> `{t('common:actions.add')}`
- `"No tags yet. Create one above!"` -> `{t('tag_manager.no_tags')}`
- `` `${tag.imageCount} ${tag.imageCount === 1 ? 'image' : 'images'}` `` -> `{t('tag_manager.image_count', { count: tag.imageCount })}` (i18next handles pluralization: `_one` for 1, `_other` for rest)
- `"Rename"` -> `{t('common:actions.rename')}`
- `"Delete"` -> `{t('common:actions.delete')}`
- `"Save"` -> `{t('common:actions.save')}`
- `"Cancel"` -> `{t('common:actions.cancel')}`
- `"Delete Tag?"` -> `{t('tag_manager.delete_tag_title')}`
- `` `This tag is used on ${confirmingTag.imageCount} ${...} image(s). Remove it?` `` -> `{t('tag_manager.delete_tag_message', { count: confirmingTag.imageCount })}`

IMPORTANT: For cross-namespace references, use the `common:key` syntax (e.g., `t('common:actions.cancel')`). This works because i18next supports namespace prefixes in key strings.

Do NOT change any styling, layout, event handlers, or non-text logic. Only replace string literals with `t()` calls.
  </action>
  <verify>
    - `cd apps/web && npx tsc --noEmit` passes
    - `grep -rn "useTranslation" apps/web/src/components/` shows all 8 component files use the hook
    - `grep -rn '"Filter by Tags"\|"Select All"\|"Manage Tags"\|"Uploading\.\.\."\|"No images yet"\|"Confirm Delete"\|"Add tags\.\.\."' apps/web/src/components/` returns NO matches (all hardcoded strings replaced)
    - `grep -rn '"Loading\.\.\."\|"Search by filename"\|"Drag and drop"\|"No tags yet"' apps/web/src/components/ apps/web/src/routes/` returns NO matches
  </verify>
  <done>All 8 image management components use translation keys via useTranslation('images'). Zero hardcoded user-facing strings remain. Pluralization uses i18next count interpolation. Cross-namespace references use common: prefix for shared buttons/status.</done>
</task>

</tasks>

<verification>
1. `cd apps/web && npx tsc --noEmit` — no type errors across entire project
2. Grep for ANY remaining hardcoded English UI strings across all components and routes:
   ```bash
   grep -rn '"Filter by\|"Select All\|"Manage Tags\|"Uploading\|"No images\|"Confirm Delete\|"Add tags\|"Loading\|"Search by\|"Drag and\|"Settings"\|"Appearance"\|"Language"\|"Light"\|"Dark"\|"System"' apps/web/src/components/ apps/web/src/routes/
   ```
   Should return NO matches.
3. Every component file contains `useTranslation`:
   ```bash
   for f in apps/web/src/components/*.tsx apps/web/src/routes/*.tsx; do grep -L "useTranslation" "$f" 2>/dev/null; done
   ```
   Only `routeTree.gen.ts` (auto-generated) should be listed, no `.tsx` component files.
4. `cd apps/web && npx vite build` — production build succeeds
</verification>

<success_criteria>
- All 12 component/route files import and use useTranslation hook
- Zero hardcoded user-facing strings remain in any component
- Pluralization works via i18next count interpolation (tag_manager.image_count)
- Cross-namespace references (common:actions.cancel) work for shared strings
- Language switching in SettingsForm triggers i18n.changeLanguage for instant UI update
- TypeScript compilation passes
- Production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/07-internationalization/07-02-SUMMARY.md`
</output>
